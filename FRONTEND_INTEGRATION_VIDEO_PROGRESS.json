{
  "endpoints": {
    "updateVideoTimestamp": {
      "method": "POST",
      "url": "/progress/video/timestamp",
      "requiresAuth": true,
      "description": "Salva a posição atual do vídeo (em segundos). Deve ser chamado periodicamente durante a reprodução."
    },
    "getInProgressVideos": {
      "method": "GET",
      "url": "/progress/videos/in-progress",
      "requiresAuth": true,
      "description": "Retorna lista de vídeos que o usuário está assistindo com a posição atual de cada um."
    }
  },
  "typescriptTypes": {
    "UpdateVideoTimestampRequest": {
      "videoId": "string",
      "timestamp": "number"
    },
    "UpdateVideoTimestampResponse": {
      "success": "boolean",
      "data": {
        "progress": {
          "id": "string",
          "userId": "string",
          "videoId": "string",
          "subCourseId": "string",
          "isCompleted": "boolean",
          "currentTimestamp": "number | null",
          "completedAt": "string | null",
          "createdAt": "string",
          "updatedAt": "string"
        }
      }
    },
    "InProgressVideo": {
      "videoId": "string",
      "videoTitle": "string",
      "videoUrl": "string",
      "thumbnailUrl": "string | null",
      "subCourseId": "string",
      "currentTimestamp": "number",
      "duration": "number | null",
      "progressPercentage": "number",
      "lastWatchedAt": "string"
    },
    "GetInProgressVideosResponse": {
      "success": "boolean",
      "data": {
        "videos": "InProgressVideo[]"
      }
    }
  },
  "dtos": {
    "UpdateVideoTimestampDto": {
      "videoId": {
        "type": "string",
        "required": true,
        "description": "ID do vídeo no YouTube (ex: 'FXqX7oof0I4')",
        "example": "FXqX7oof0I4"
      },
      "timestamp": {
        "type": "number",
        "required": true,
        "minimum": 0,
        "description": "Posição atual do vídeo em segundos",
        "example": 120
      }
    },
    "InProgressVideoDto": {
      "videoId": {
        "type": "string",
        "description": "ID do vídeo no YouTube",
        "example": "FXqX7oof0I4"
      },
      "videoTitle": {
        "type": "string",
        "description": "Título do vídeo",
        "example": "Curso React: Introdução - #01"
      },
      "videoUrl": {
        "type": "string",
        "description": "URL completa do vídeo",
        "example": "https://www.youtube.com/watch?v=FXqX7oof0I4"
      },
      "thumbnailUrl": {
        "type": "string | null",
        "description": "URL da thumbnail do vídeo",
        "example": "https://i.ytimg.com/vi/FXqX7oof0I4/hqdefault.jpg"
      },
      "subCourseId": {
        "type": "string",
        "description": "ID do sub-curso ao qual o vídeo pertence",
        "example": "86888b9e-e12f-4c6b-a3da-11b812a19a68"
      },
      "currentTimestamp": {
        "type": "number",
        "description": "Posição atual do vídeo em segundos (onde o usuário parou)",
        "example": 120
      },
      "duration": {
        "type": "number | null",
        "description": "Duração total do vídeo em segundos",
        "example": 600
      },
      "progressPercentage": {
        "type": "number",
        "description": "Percentual de progresso do vídeo (0-100)",
        "example": 20
      },
      "lastWatchedAt": {
        "type": "string",
        "format": "ISO 8601 date-time",
        "description": "Data e hora da última visualização",
        "example": "2024-01-15T10:30:00.000Z"
      }
    }
  },
  "examples": {
    "updateVideoTimestamp": {
      "request": {
        "method": "POST",
        "url": "https://seu-backend.com/progress/video/timestamp",
        "headers": {
          "Authorization": "Bearer <seu-jwt-token>",
          "Content-Type": "application/json"
        },
        "body": {
          "videoId": "FXqX7oof0I4",
          "timestamp": 120
        }
      },
      "response": {
        "success": true,
        "data": {
          "progress": {
            "id": "550e8400-e29b-41d4-a716-446655440000",
            "userId": "user-uuid",
            "videoId": "video-uuid",
            "subCourseId": "subcourse-uuid",
            "isCompleted": false,
            "currentTimestamp": 120,
            "completedAt": null,
            "createdAt": "2024-01-15T10:00:00.000Z",
            "updatedAt": "2024-01-15T10:30:00.000Z"
          }
        }
      },
      "errorResponse": {
        "success": false,
        "message": "Vídeo não encontrado"
      }
    },
    "getInProgressVideos": {
      "request": {
        "method": "GET",
        "url": "https://seu-backend.com/progress/videos/in-progress",
        "headers": {
          "Authorization": "Bearer <seu-jwt-token>"
        }
      },
      "response": {
        "success": true,
        "data": {
          "videos": [
            {
              "videoId": "FXqX7oof0I4",
              "videoTitle": "Curso React: Introdução - #01",
              "videoUrl": "https://www.youtube.com/watch?v=FXqX7oof0I4",
              "thumbnailUrl": "https://i.ytimg.com/vi/FXqX7oof0I4/hqdefault.jpg",
              "subCourseId": "86888b9e-e12f-4c6b-a3da-11b812a19a68",
              "currentTimestamp": 120,
              "duration": 600,
              "progressPercentage": 20,
              "lastWatchedAt": "2024-01-15T10:30:00.000Z"
            },
            {
              "videoId": "Jg6JaEjovJk",
              "videoTitle": "Curso React: Componentes - #02",
              "videoUrl": "https://www.youtube.com/watch?v=Jg6JaEjovJk",
              "thumbnailUrl": "https://i.ytimg.com/vi/Jg6JaEjovJk/hqdefault.jpg",
              "subCourseId": "86888b9e-e12f-4c6b-a3da-11b812a19a68",
              "currentTimestamp": 45,
              "duration": 480,
              "progressPercentage": 9,
              "lastWatchedAt": "2024-01-14T15:20:00.000Z"
            }
          ]
        }
      },
      "emptyResponse": {
        "success": true,
        "data": {
          "videos": []
        }
      }
    }
  },
  "frontendImplementationGuide": {
    "typescriptTypes": "// Tipos TypeScript para usar no frontend\n\nexport interface UpdateVideoTimestampRequest {\n  videoId: string;\n  timestamp: number;\n}\n\nexport interface VideoProgress {\n  id: string;\n  userId: string;\n  videoId: string;\n  subCourseId: string;\n  isCompleted: boolean;\n  currentTimestamp: number | null;\n  completedAt: string | null;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface UpdateVideoTimestampResponse {\n  success: boolean;\n  data: {\n    progress: VideoProgress;\n  };\n}\n\nexport interface InProgressVideo {\n  videoId: string;\n  videoTitle: string;\n  videoUrl: string;\n  thumbnailUrl: string | null;\n  subCourseId: string;\n  currentTimestamp: number;\n  duration: number | null;\n  progressPercentage: number;\n  lastWatchedAt: string;\n}\n\nexport interface GetInProgressVideosResponse {\n  success: boolean;\n  data: {\n    videos: InProgressVideo[];\n  };\n}",
    "axiosExample": "// Exemplo usando Axios\n\nimport axios from 'axios';\n\nconst API_URL = 'https://seu-backend.com';\n\n// Função para atualizar timestamp do vídeo\nexport async function updateVideoTimestamp(\n  token: string,\n  videoId: string,\n  timestamp: number\n): Promise<UpdateVideoTimestampResponse> {\n  const response = await axios.post(\n    `${API_URL}/progress/video/timestamp`,\n    { videoId, timestamp },\n    {\n      headers: {\n        Authorization: `Bearer ${token}`,\n        'Content-Type': 'application/json',\n      },\n    }\n  );\n  return response.data;\n}\n\n// Função para buscar vídeos em progresso\nexport async function getInProgressVideos(\n  token: string\n): Promise<GetInProgressVideosResponse> {\n  const response = await axios.get(\n    `${API_URL}/progress/videos/in-progress`,\n    {\n      headers: {\n        Authorization: `Bearer ${token}`,\n      },\n    }\n  );\n  return response.data;\n}",
    "fetchExample": "// Exemplo usando Fetch API\n\nconst API_URL = 'https://seu-backend.com';\n\n// Função para atualizar timestamp do vídeo\nexport async function updateVideoTimestamp(\n  token: string,\n  videoId: string,\n  timestamp: number\n): Promise<UpdateVideoTimestampResponse> {\n  const response = await fetch(`${API_URL}/progress/video/timestamp`, {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${token}`,\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({ videoId, timestamp }),\n  });\n  return response.json();\n}\n\n// Função para buscar vídeos em progresso\nexport async function getInProgressVideos(\n  token: string\n): Promise<GetInProgressVideosResponse> {\n  const response = await fetch(`${API_URL}/progress/videos/in-progress`, {\n    method: 'GET',\n    headers: {\n      'Authorization': `Bearer ${token}`,\n    },\n  });\n  return response.json();\n}",
    "youtubePlayerIntegration": "// Exemplo de integração com YouTube Player API\n\n// No componente do player de vídeo:\n\nuseEffect(() => {\n  let intervalId: NodeJS.Timeout;\n  \n  // Salvar timestamp a cada 10 segundos\n  if (player && typeof player.getCurrentTime === 'function') {\n    intervalId = setInterval(async () => {\n      try {\n        const currentTime = await player.getCurrentTime();\n        const timestampInSeconds = Math.floor(currentTime);\n        \n        // Só atualiza se tiver pelo menos 5 segundos assistidos\n        if (timestampInSeconds >= 5) {\n          await updateVideoTimestamp(\n            userToken,\n            videoId,\n            timestampInSeconds\n          );\n        }\n      } catch (error) {\n        console.error('Erro ao salvar timestamp:', error);\n      }\n    }, 10000); // A cada 10 segundos\n  }\n  \n  return () => {\n    if (intervalId) {\n      clearInterval(intervalId);\n    }\n  };\n}, [player, videoId, userToken]);\n\n// Ao carregar o vídeo, restaurar posição salva\nuseEffect(() => {\n  const loadVideoProgress = async () => {\n    try {\n      const response = await getInProgressVideos(userToken);\n      const video = response.data.videos.find(v => v.videoId === currentVideoId);\n      \n      if (video && video.currentTimestamp && player) {\n        // Restaurar posição do vídeo\n        player.seekTo(video.currentTimestamp, true);\n      }\n    } catch (error) {\n      console.error('Erro ao carregar progresso:', error);\n    }\n  };\n  \n  loadVideoProgress();\n}, [currentVideoId, userToken, player]);"
  },
  "authentication": {
    "required": true,
    "method": "JWT Bearer Token",
    "header": "Authorization: Bearer <seu-jwt-token>",
    "note": "Todos os endpoints requerem autenticação. O token é obtido no login."
  },
  "bestPractices": {
    "updateTimestamp": [
      "Atualize o timestamp periodicamente durante a reprodução (ex: a cada 10-30 segundos)",
      "Não envie a cada segundo para evitar muitas requisições",
      "Atualize também quando o usuário pausar o vídeo",
      "Não envie timestamp = 0 se o usuário não assistiu nada ainda"
    ],
    "getInProgressVideos": [
      "Cache a resposta no frontend por alguns segundos",
      "Chame ao abrir a seção 'Continuar Assistindo'",
      "Ordene por lastWatchedAt (já vem ordenado do backend, mais recentes primeiro)"
    ],
    "errorHandling": [
      "Trate erros 401 (não autorizado) fazendo logout",
      "Trate erros 400 (dados inválidos) mostrando mensagem ao usuário",
      "Trate erros 500 (servidor) com mensagem genérica"
    ]
  },
  "statusCodes": {
    "200": "Sucesso - Requisição processada com sucesso",
    "201": "Criado - Recurso criado com sucesso",
    "400": "Erro - Dados inválidos ou vídeo não encontrado",
    "401": "Não autorizado - Token inválido ou ausente",
    "500": "Erro interno do servidor"
  }
}





