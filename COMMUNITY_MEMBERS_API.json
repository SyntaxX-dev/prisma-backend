{
  "title": "API de Membros de Comunidades - Documenta√ß√£o Completa",
  "description": "Documenta√ß√£o dos endpoints para entrar, sair e listar membros de comunidades",
  "baseUrl": "https://prisma-backend-production-4c22.up.railway.app",
  "endpoints": {
    "joinCommunity": {
      "method": "POST",
      "path": "/communities/join",
      "description": "Entrar em uma comunidade (p√∫blica ou privada com convite)",
      "authentication": {
        "required": true,
        "header": "Authorization: Bearer <token>"
      },
      "request": {
        "headers": {
          "Authorization": "Bearer <seu-token-jwt>",
          "Content-Type": "application/json"
        },
        "body": {
          "communityId": "uuid-da-comunidade"
        },
        "example": {
          "communityId": "1b380319-9336-479a-8ac2-aed60cfdae4c"
        }
      },
      "response": {
        "success": {
          "statusCode": 200,
          "body": {
            "success": true,
            "message": "Voc√™ entrou na comunidade com sucesso"
          }
        },
        "errors": {
          "400": {
            "description": "Voc√™ j√° √© membro desta comunidade",
            "body": {
              "statusCode": 400,
              "message": "Voc√™ j√° √© membro desta comunidade",
              "error": "Bad Request"
            }
          },
          "400_private": {
            "description": "Comunidade privada sem convite",
            "body": {
              "statusCode": 400,
              "message": "Esta comunidade √© privada. Voc√™ precisa de um convite para participar.",
              "error": "Bad Request"
            }
          },
          "404": {
            "description": "Comunidade n√£o encontrada",
            "body": {
              "statusCode": 404,
              "message": "Comunidade n√£o encontrada",
              "error": "Not Found"
            }
          }
        }
      },
      "businessRules": {
        "publicCommunities": {
          "description": "Comunidades p√∫blicas",
          "rules": [
            "Qualquer usu√°rio autenticado pode entrar diretamente",
            "N√£o precisa de convite",
            "Se sair, pode entrar novamente a qualquer momento"
          ]
        },
        "privateCommunities": {
          "description": "Comunidades privadas",
          "rules": [
            "Requer convite pendente para entrar",
            "O convite √© aceito automaticamente ao entrar",
            "Se sair, precisa de novo convite para entrar novamente"
          ]
        },
        "validations": [
          "Verifica se o usu√°rio j√° √© membro (retorna erro se for)",
          "Verifica se a comunidade existe",
          "Para privadas, verifica se h√° convite pendente",
          "Adiciona o usu√°rio como membro automaticamente"
        ]
      },
      "codeExamples": {
        "javascript": "async function joinCommunity(communityId, token) {\n  const response = await fetch('https://prisma-backend-production-4c22.up.railway.app/communities/join', {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${token}`,\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({ communityId })\n  });\n\n  if (!response.ok) {\n    const error = await response.json();\n    throw new Error(error.message);\n  }\n\n  const result = await response.json();\n  return result;\n}\n\n// Uso:\nconst token = localStorage.getItem('token');\nconst result = await joinCommunity('1b380319-9336-479a-8ac2-aed60cfdae4c', token);\nconsole.log(result.message); // 'Voc√™ entrou na comunidade com sucesso'",
        "react": "function JoinCommunityButton({ communityId }) {\n  const [loading, setLoading] = useState(false);\n  const token = useAuth().token;\n\n  const handleJoin = async () => {\n    setLoading(true);\n    try {\n      const response = await fetch('/communities/join', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({ communityId })\n      });\n\n      const result = await response.json();\n      \n      if (result.success) {\n        toast.success(result.message);\n        // Atualizar UI - marcar como membro\n        updateCommunityStatus(communityId, { isMember: true });\n      }\n    } catch (error) {\n      toast.error(error.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <button onClick={handleJoin} disabled={loading}>\n      {loading ? 'Entrando...' : 'Entrar na Comunidade'}\n    </button>\n  );\n}"
      }
    },
    "leaveCommunity": {
      "method": "POST",
      "path": "/communities/leave",
      "description": "Sair de uma comunidade (p√∫blica ou privada)",
      "authentication": {
        "required": true,
        "header": "Authorization: Bearer <token>"
      },
      "request": {
        "headers": {
          "Authorization": "Bearer <seu-token-jwt>",
          "Content-Type": "application/json"
        },
        "body": {
          "communityId": "uuid-da-comunidade"
        },
        "example": {
          "communityId": "1b380319-9336-479a-8ac2-aed60cfdae4c"
        }
      },
      "response": {
        "success": {
          "statusCode": 200,
          "body": {
            "success": true,
            "message": "Voc√™ saiu da comunidade com sucesso"
          }
        },
        "errors": {
          "400": {
            "description": "Usu√°rio n√£o √© membro",
            "body": {
              "statusCode": 400,
              "message": "Voc√™ n√£o √© membro desta comunidade",
              "error": "Bad Request"
            }
          },
          "403": {
            "description": "Dono n√£o pode sair",
            "body": {
              "statusCode": 403,
              "message": "O dono da comunidade n√£o pode sair. Se deseja excluir a comunidade, use o endpoint de exclus√£o.",
              "error": "Forbidden"
            }
          },
          "404": {
            "description": "Comunidade n√£o encontrada",
            "body": {
              "statusCode": 404,
              "message": "Comunidade n√£o encontrada",
              "error": "Not Found"
            }
          }
        }
      },
      "businessRules": {
        "publicCommunities": {
          "description": "Comunidades p√∫blicas",
          "rules": [
            "Usu√°rio pode sair a qualquer momento",
            "Ap√≥s sair, pode entrar novamente diretamente (sem convite)",
            "N√£o h√° restri√ß√µes para reentrada"
          ]
        },
        "privateCommunities": {
          "description": "Comunidades privadas",
          "rules": [
            "Usu√°rio pode sair a qualquer momento",
            "Ap√≥s sair, precisa de NOVO convite para entrar novamente",
            "Convites anteriores s√£o considerados inv√°lidos ap√≥s sair"
          ]
        },
        "ownerRestriction": {
          "description": "Restri√ß√£o para dono",
          "rules": [
            "O dono N√ÉO pode sair da comunidade",
            "Se o dono quiser remover a comunidade, deve usar endpoint de exclus√£o",
            "Isso garante que sempre haver√° um respons√°vel pela comunidade"
          ]
        },
        "validations": [
          "Verifica se a comunidade existe",
          "Verifica se o usu√°rio √© membro",
          "Impede que o dono saia",
          "Remove o usu√°rio da lista de membros"
        ]
      },
      "codeExamples": {
        "javascript": "async function leaveCommunity(communityId, token) {\n  const response = await fetch('https://prisma-backend-production-4c22.up.railway.app/communities/leave', {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${token}`,\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({ communityId })\n  });\n\n  if (!response.ok) {\n    const error = await response.json();\n    throw new Error(error.message);\n  }\n\n  const result = await response.json();\n  return result;\n}\n\n// Uso:\nconst token = localStorage.getItem('token');\nconst result = await leaveCommunity('1b380319-9336-479a-8ac2-aed60cfdae4c', token);\nconsole.log(result.message); // 'Voc√™ saiu da comunidade com sucesso'",
        "react": "function LeaveCommunityButton({ communityId, isOwner }) {\n  const [loading, setLoading] = useState(false);\n  const token = useAuth().token;\n\n  // Dono n√£o pode sair\n  if (isOwner) {\n    return (\n      <button disabled>\n        Voc√™ √© o dono (n√£o pode sair)\n      </button>\n    );\n  }\n\n  const handleLeave = async () => {\n    if (!confirm('Tem certeza que deseja sair desta comunidade?')) {\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const response = await fetch('/communities/leave', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({ communityId })\n      });\n\n      const result = await response.json();\n      \n      if (result.success) {\n        toast.success(result.message);\n        // Atualizar UI - marcar como n√£o membro\n        updateCommunityStatus(communityId, { isMember: false });\n      }\n    } catch (error) {\n      toast.error(error.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <button onClick={handleLeave} disabled={loading}>\n      {loading ? 'Saindo...' : 'Sair da Comunidade'}\n    </button>\n  );\n}"
      }
    },
    "listCommunityMembers": {
      "method": "GET",
      "path": "/communities/:id/members",
      "description": "Listar membros de uma comunidade com pagina√ß√£o",
      "authentication": {
        "required": false,
        "note": "Opcional para comunidades p√∫blicas, obrigat√≥rio para privadas",
        "header": "Authorization: Bearer <token>"
      },
      "queryParameters": {
        "limit": {
          "type": "number",
          "required": false,
          "default": 20,
          "maximum": 100,
          "description": "N√∫mero de membros por p√°gina",
          "example": "?limit=20"
        },
        "offset": {
          "type": "number",
          "required": false,
          "default": 0,
          "description": "N√∫mero de membros para pular (para pagina√ß√£o)",
          "example": "?offset=0"
        }
      },
      "request": {
        "publicCommunity": {
          "description": "Comunidade p√∫blica - sem autentica√ß√£o",
          "headers": {},
          "url": "GET /communities/123/members?limit=20&offset=0"
        },
        "privateCommunity": {
          "description": "Comunidade privada - requer autentica√ß√£o",
          "headers": {
            "Authorization": "Bearer <token>"
          },
          "url": "GET /communities/123/members?limit=20&offset=0"
        }
      },
      "response": {
        "success": {
          "statusCode": 200,
          "body": {
            "success": true,
            "data": {
              "members": [
                {
                  "id": "d99f095c-32e1-496e-b20e-73a554bb9538",
                  "name": "Jo√£o Silva",
                  "profileImage": "https://res.cloudinary.com/.../profile.jpg",
                  "joinedAt": "2025-11-08T20:05:11.628Z",
                  "isOwner": true
                },
                {
                  "id": "a1b2c3d4-5678-90ab-cdef-123456789012",
                  "name": "Maria Santos",
                  "profileImage": null,
                  "joinedAt": "2025-11-08T21:10:30.500Z",
                  "isOwner": false
                },
                {
                  "id": "b2c3d4e5-6789-01ab-cdef-234567890123",
                  "name": "Pedro Oliveira",
                  "profileImage": "https://res.cloudinary.com/.../pedro.jpg",
                  "joinedAt": "2025-11-09T10:15:20.300Z",
                  "isOwner": false
                }
              ],
              "total": 50,
              "limit": 20,
              "offset": 0,
              "hasMore": true
            }
          }
        },
        "errors": {
          "403_private": {
            "description": "Acesso negado a comunidade privada",
            "body": {
              "statusCode": 403,
              "message": "Esta comunidade √© privada. Voc√™ precisa estar autenticado e ser membro para visualizar os membros.",
              "error": "Forbidden"
            }
          },
          "403_not_member": {
            "description": "N√£o √© membro de comunidade privada",
            "body": {
              "statusCode": 403,
              "message": "Voc√™ n√£o tem permiss√£o para visualizar os membros desta comunidade privada",
              "error": "Forbidden"
            }
          },
          "404": {
            "description": "Comunidade n√£o encontrada",
            "body": {
              "statusCode": 404,
              "message": "Comunidade n√£o encontrada",
              "error": "Not Found"
            }
          }
        }
      },
      "memberFields": {
        "id": {
          "type": "string",
          "description": "ID √∫nico do usu√°rio",
          "example": "d99f095c-32e1-496e-b20e-73a554bb9538"
        },
        "name": {
          "type": "string",
          "description": "Nome completo do usu√°rio",
          "example": "Jo√£o Silva"
        },
        "profileImage": {
          "type": "string | null",
          "description": "URL da imagem de perfil do usu√°rio (pode ser null)",
          "example": "https://res.cloudinary.com/.../profile.jpg"
        },
        "joinedAt": {
          "type": "string (ISO 8601)",
          "description": "Data e hora em que o usu√°rio entrou na comunidade",
          "example": "2025-11-08T20:05:11.628Z"
        },
        "isOwner": {
          "type": "boolean",
          "description": "Indica se o usu√°rio √© o dono/criador da comunidade",
          "example": true
        }
      },
      "paginationFields": {
        "total": {
          "type": "number",
          "description": "Total de membros na comunidade",
          "example": 50
        },
        "limit": {
          "type": "number",
          "description": "N√∫mero de membros retornados nesta p√°gina",
          "example": 20
        },
        "offset": {
          "type": "number",
          "description": "N√∫mero de membros pulados (para pagina√ß√£o)",
          "example": 0
        },
        "hasMore": {
          "type": "boolean",
          "description": "Indica se h√° mais p√°ginas dispon√≠veis",
          "example": true,
          "calculation": "offset + limit < total"
        }
      },
      "businessRules": {
        "ordering": {
          "description": "Ordena√ß√£o dos membros",
          "rules": [
            "O dono sempre aparece primeiro na lista",
            "Demais membros s√£o ordenados por data de entrada (mais antigos primeiro)",
            "Isso garante que o criador seja sempre vis√≠vel"
          ]
        },
        "accessControl": {
          "publicCommunities": [
            "Qualquer pessoa pode ver os membros (mesmo sem autentica√ß√£o)",
            "N√£o requer token JWT"
          ],
          "privateCommunities": [
            "Apenas membros e dono podem ver a lista de membros",
            "Requer autentica√ß√£o",
            "Verifica se o usu√°rio √© membro ou dono"
          ]
        },
        "pagination": {
          "description": "Sistema de pagina√ß√£o",
          "rules": [
            "Padr√£o: 20 membros por p√°gina",
            "M√°ximo: 100 membros por p√°gina",
            "Use offset para navegar entre p√°ginas",
            "hasMore indica se h√° mais resultados"
          ]
        }
      },
      "codeExamples": {
        "javascript": "async function listCommunityMembers(communityId, token = null, limit = 20, offset = 0) {\n  const headers = {};\n  if (token) {\n    headers['Authorization'] = `Bearer ${token}`;\n  }\n\n  const response = await fetch(\n    `https://prisma-backend-production-4c22.up.railway.app/communities/${communityId}/members?limit=${limit}&offset=${offset}`,\n    { headers }\n  );\n\n  if (!response.ok) {\n    const error = await response.json();\n    throw new Error(error.message);\n  }\n\n  const result = await response.json();\n  return result.data;\n}\n\n// Uso:\nconst token = localStorage.getItem('token');\nconst page1 = await listCommunityMembers('123', token, 20, 0);\nconsole.log(`Total: ${page1.total}, Mostrando: ${page1.members.length}`);\n\n// Pr√≥xima p√°gina\nif (page1.hasMore) {\n  const page2 = await listCommunityMembers('123', token, 20, 20);\n}",
        "react": "function CommunityMembersList({ communityId, isPrivate }) {\n  const [members, setMembers] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [pagination, setPagination] = useState({ total: 0, limit: 20, offset: 0, hasMore: false });\n  const token = useAuth().token;\n\n  const fetchMembers = async (offset = 0) => {\n    setLoading(true);\n    try {\n      const headers = {};\n      if (token || isPrivate) {\n        headers['Authorization'] = `Bearer ${token}`;\n      }\n\n      const response = await fetch(\n        `/communities/${communityId}/members?limit=20&offset=${offset}`,\n        { headers }\n      );\n\n      const result = await response.json();\n      \n      if (result.success) {\n        setMembers(result.data.members);\n        setPagination({\n          total: result.data.total,\n          limit: result.data.limit,\n          offset: result.data.offset,\n          hasMore: result.data.hasMore\n        });\n      }\n    } catch (error) {\n      console.error('Erro ao buscar membros:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchMembers();\n  }, [communityId]);\n\n  const loadMore = () => {\n    if (pagination.hasMore) {\n      fetchMembers(pagination.offset + pagination.limit);\n    }\n  };\n\n  if (loading) return <div>Carregando membros...</div>;\n\n  return (\n    <div>\n      <h3>Membros ({pagination.total})</h3>\n      \n      {members.map(member => (\n        <div key={member.id} className=\"member-card\">\n          {member.profileImage && (\n            <img src={member.profileImage} alt={member.name} />\n          )}\n          <div>\n            <h4>{member.name}</h4>\n            {member.isOwner && <span className=\"badge\">üëë Dono</span>}\n            <p>Entrou em: {new Date(member.joinedAt).toLocaleDateString()}</p>\n          </div>\n        </div>\n      ))}\n      \n      {pagination.hasMore && (\n        <button onClick={loadMore}>Carregar mais membros</button>\n      )}\n    </div>\n  );\n}"
      }
    }
  },
  "workflowExamples": {
    "joinPublicCommunity": {
      "step1": "GET /communities - Listar comunidades p√∫blicas",
      "step2": "POST /communities/join - Entrar na comunidade (com token)",
      "step3": "GET /communities/:id/members - Ver membros",
      "step4": "POST /communities/leave - Sair (opcional)",
      "step5": "POST /communities/join - Entrar novamente (pode entrar de novo)"
    },
    "joinPrivateCommunity": {
      "step1": "POST /communities/invite - Receber convite (de outro membro)",
      "step2": "POST /communities/join - Entrar na comunidade (aceita convite automaticamente)",
      "step3": "GET /communities/:id/members - Ver membros (requer autentica√ß√£o)",
      "step4": "POST /communities/leave - Sair (opcional)",
      "step5": "POST /communities/invite - Precisa de NOVO convite para entrar novamente"
    }
  },
  "importantNotes": {
    "authentication": {
      "join": "SEMPRE requer autentica√ß√£o (token JWT obrigat√≥rio)",
      "leave": "SEMPRE requer autentica√ß√£o (token JWT obrigat√≥rio)",
      "listMembers": "Opcional para p√∫blicas, obrigat√≥rio para privadas"
    },
    "ownerRestrictions": {
      "cannotLeave": "O dono N√ÉO pode sair da comunidade",
      "alwaysFirst": "O dono sempre aparece primeiro na lista de membros",
      "alwaysMember": "O dono sempre √© considerado membro (isMember: true)"
    },
    "privateCommunities": {
      "joinRequiresInvite": "Precisa de convite pendente para entrar",
      "leaveRequiresNewInvite": "Se sair, precisa de novo convite para entrar",
      "membersListRequiresAuth": "Lista de membros s√≥ vis√≠vel para membros/dono"
    },
    "publicCommunities": {
      "joinFree": "Qualquer um pode entrar diretamente",
      "leaveAndRejoin": "Pode sair e entrar novamente sem restri√ß√µes",
      "membersListPublic": "Lista de membros √© p√∫blica (vis√≠vel para todos)"
    }
  },
  "errorHandling": {
    "commonErrors": {
      "400_already_member": "Usu√°rio j√° √© membro - n√£o tente entrar novamente",
      "400_not_member": "Usu√°rio n√£o √© membro - n√£o pode sair",
      "403_owner_cannot_leave": "Dono n√£o pode sair - use endpoint de exclus√£o",
      "403_private_access": "Comunidade privada - precisa ser membro para ver membros",
      "404_community_not_found": "Comunidade n√£o existe - verifique o ID"
    },
    "bestPractices": [
      "Sempre verificar isMember antes de mostrar bot√£o 'Entrar'",
      "Sempre verificar isOwner antes de permitir sair",
      "Tratar erros 403 para comunidades privadas",
      "Implementar retry para erros de rede",
      "Mostrar loading states durante requisi√ß√µes"
    ]
  },
  "uiRecommendations": {
    "joinButton": {
      "showWhen": "isMember === false",
      "hideWhen": "isMember === true",
      "text": "Entrar na Comunidade",
      "loadingText": "Entrando...",
      "successMessage": "Voc√™ entrou na comunidade com sucesso!"
    },
    "leaveButton": {
      "showWhen": "isMember === true && isOwner === false",
      "hideWhen": "isMember === false || isOwner === true",
      "text": "Sair da Comunidade",
      "loadingText": "Saindo...",
      "confirmDialog": "Tem certeza que deseja sair desta comunidade?",
      "successMessage": "Voc√™ saiu da comunidade com sucesso!"
    },
    "membersList": {
      "showOwnerBadge": "Sempre mostrar badge 'üëë Dono' quando isOwner === true",
      "showProfileImage": "Mostrar imagem de perfil ou avatar padr√£o",
      "showJoinDate": "Mostrar data de entrada formatada",
      "pagination": "Implementar bot√£o 'Carregar mais' quando hasMore === true",
      "emptyState": "Mostrar mensagem quando n√£o houver membros"
    }
  },
  "quickReference": {
    "join": {
      "endpoint": "POST /communities/join",
      "auth": "Obrigat√≥rio",
      "body": "{ communityId: string }",
      "success": "{ success: true, message: string }"
    },
    "leave": {
      "endpoint": "POST /communities/leave",
      "auth": "Obrigat√≥rio",
      "body": "{ communityId: string }",
      "success": "{ success: true, message: string }",
      "restriction": "Dono n√£o pode sair"
    },
    "listMembers": {
      "endpoint": "GET /communities/:id/members",
      "auth": "Opcional (obrigat√≥rio para privadas)",
      "query": "?limit=20&offset=0",
      "success": "{ success: true, data: { members: [...], total, limit, offset, hasMore } }"
    }
  }
}

